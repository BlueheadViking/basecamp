<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Domain Knowledge – Perfect Ring via forceRadial</title>
  <style>
    body { margin:0; background:#181818; }
    svg  { width:100vw; height:100vh; display:block; }
    circle { stroke:#fff; }
    text   { font:14px Inter,Arial,sans-serif; fill:#fff; pointer-events:none; }
  </style>
</head>
<body>
<svg></svg>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// 1) Data
const data = {
  name: "Griffin's Domain Knowledge",
  children: [
    { name:"Aviation", children:["AVT","Spray Ops","Navigation","Firefighting Aviation","Fleet Mgmt","Guidance Lines"] },
    { name:"Agriculture", children:["Spreading","Proof of Placement","Variable Rate","Orchard/Hort","Field Tasking","Soil Health","Crop Planning"] },
    { name:"Mapping", children:["Feature Editing","Mapbox","Geospatial Data","Layer Control","Photo Mapping","Job Mapping"] },
    { name:"Ground Ops", children:["GVT","Mosquito Ctrl","Tasking","Field Capture"] },
    { name:"Product Design & SaaS", children:["UX/UI Design","Design Systems","Prototyping","SaaS Systems","Customer Eng.","Validation","Figma","AI Tools"] },
    { name:"Other", children:["Photography","Side Projects","Game Dev"] }
  ]
};

// 2) Hierarchy → nodes & links
const root  = d3.hierarchy(data);
const nodes = root.descendants();
const links = root.links();

// 3) Dimensions & radii
let width  = window.innerWidth;
let height = window.innerHeight;
const INNER_RADIUS = 180;
const OUTER_RADIUS = Math.min(width, height)/2 - 80;

// 4) SVG setup
const svg   = d3.select("svg")
                .attr("width", width)
                .attr("height", height);
const linkG = svg.append("g").attr("stroke","#888").attr("stroke-opacity",0.6);
const nodeG = svg.append("g");

// 5) Force simulation with forceRadial for leaves
const sim = d3.forceSimulation(nodes)
  .force("link", d3.forceLink(links)
    .id(d=>d.data.name)
    .distance(d=> d.source.depth===0 ? 200 : 120)
    .strength(1.3))
  .force("charge",    d3.forceManyBody().strength(-900))
  .force("center",    d3.forceCenter(width/2, height/2))
  .force("collision", d3.forceCollide().radius(d=> d.depth===0?50:d.depth===1?40:28).strength(1.2))
  // inner ring for first-layer branches
  .force("radialBr",  d3.forceRadial(d=> d.depth===1 ? INNER_RADIUS : 0, width/2, height/2).strength(0.8))
  // outer ring for leaves, stronger pull
  .force("radialLf",  d3.forceRadial(d=> d.depth===2 ? OUTER_RADIUS : 0, width/2, height/2).strength(0.6));

// 6) Draw links
const link = linkG.selectAll("line")
  .data(links)
  .join("line")
    .attr("stroke-width",2);

// 7) Draw nodes
const node = nodeG.selectAll("g")
  .data(nodes)
  .join("g")
    .call(d3.drag()
      .on("start", dragStart)
      .on("drag",  dragging)
      .on("end",   dragEnd)
    );

node.append("circle")
    .attr("r", d=> d.depth===0 ? 45 : d.depth===1 ? 30 : 22)
    .attr("fill", d=> d.depth===0 ? "#2bc58b" : "#0D5239");

node.append("text")
    .attr("dy","0.32em")
    .attr("text-anchor","middle")
    .text(d=>d.data.name);

// 8) Tick: update positions
sim.on("tick", () => {
  link
    .attr("x1",d=>d.source.x).attr("y1",d=>d.source.y)
    .attr("x2",d=>d.target.x).attr("y2",d=>d.target.y);

  node
    .attr("transform",d=>`translate(${d.x},${d.y})`);
});

// 9) Drag handlers
function dragStart(event,d){
  if (!event.active) sim.alphaTarget(0.3).restart();
  d.fx = d.x; d.fy = d.y;
}
function dragging(event,d){
  d.fx = event.x; d.fy = event.y;
}
function dragEnd(event,d){
  if (!event.active) sim.alphaTarget(0);
  d.fx = null; d.fy = null;
}

// 10) Resize
window.addEventListener("resize", () => {
  width  = window.innerWidth;
  height = window.innerHeight;
  svg.attr("width",width).attr("height",height);
  sim.force("center",   d3.forceCenter(width/2, height/2));
  sim.force("radialLf", d3.forceRadial(d=> d.depth===2 ? Math.min(width, height)/2 - 80 : 0, width/2, height/2).strength(0.6));
  sim.alpha(0.5).restart();
});
</script>
</body>
</html>
